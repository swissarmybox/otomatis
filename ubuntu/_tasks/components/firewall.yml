- name: ufw | install
  become: yes
  apt:
    name: ufw

- name: ufw | reject every incoming
  become: yes
  community.general.ufw:
    direction: incoming
    default: deny

- name: ufw | allow every outgoing
  become: yes
  community.general.ufw:
    direction: outgoing
    default: allow

- name: ufw | limit brute force ssh
  become: yes
  community.general.ufw:
    rule: limit
    port: ssh
    proto: tcp

- name: ufw | disable ping
  become: yes
  lineinfile: dest=/etc/ufw/before.rules regexp="ufw-before-input -p icmp --icmp-type {{ item }}" line="-A ufw-before-input -p icmp --icmp-type {{ item }} -j DROP" backup=yes
  with_items:
    - echo-request

- name: ufw | disable ipv6 ping
  become: yes
  lineinfile: dest=/etc/ufw/before6.rules regexp="ufw6-before-input -p icmpv6 --icmpv6-type {{ item }}" line="-A ufw6-before-input -p icmpv6 --icmpv6-type {{ item }} -j DROP" backup=yes
  with_items:
    - echo-request

- name: ufw | enable
  become: yes
  community.general.ufw:
    state: enabled
